# 1. MyBatis

- SQL구문과 Java Code분리
    - Pure JDBC는 SQL과 Java가 하나의 파일에 공존함(DAO) ⇒ 쿼리 변경 할때마다 컴파일 해야 함
    - 하지만 MyBatis는 XML에서 관리하므로 쿼리가 변경될 경우 XML만 수정해주면 된다.
- SQL 실행 결과는 Map에 mapping
- Datasource 및 Transaction 기능 제공
    - Datasource : Connection Pool 관리
    - DB에 접근할 때마다 connection을 생성하고 종료하는 것은 효율적이지 않음
    - connection pool을 통해서 미리 connection을 만들어놓음
    - 따라서 특정 프로그램이 DB에 연결할 때마다 미리 생성된 connection을 통해 DB에 요청하고 다 사용하면 반납
    - **Connection에 대한 비용**
        
        데이터베이스(DB) **connection을 생성하는 비용이 많이 드는 이유**는 여러 가지가 있는데, 주요 원인은 다음과 같아.
        
        ### 1. **네트워크 연결 비용**
        
        - DB 서버는 보통 애플리케이션 서버와 분리되어 있고, TCP/IP를 통해 통신해.
        - 새로운 connection을 생성할 때, 클라이언트와 서버 간의 **핸드셰이크**(TCP 3-way handshake + SSL handshake 등)가 필요해.
        - 특히 **TLS/SSL 암호화가 적용된 경우**, 보안 인증 과정이 추가되어 시간이 더 걸려.
        
        ### 2. **인증 및 권한 확인 과정**
        
        - DBMS는 새로운 클라이언트가 접속할 때마다 **사용자 인증(Authentication)**을 수행해.
        - 이후 해당 사용자가 특정 테이블에 접근할 권한이 있는지 **권한 확인(Authorization)** 과정도 필요해.
        - DBMS에 따라 Kerberos, LDAP 등 외부 인증 시스템과 연동될 수도 있어서 시간이 더 소요될 수 있어.
        
        ### 3. **세션 및 리소스 할당 비용**
        
        - 새로운 연결이 생성될 때, DBMS는 해당 클라이언트의 **세션을 초기화하고 리소스를 할당**해야 해.
        - 예를 들어, **세션 캐시, 메모리 공간, 작업 큐** 등이 생성되거나 관리돼야 함.
        - Oracle, MySQL 등에서는 세션을 만들 때 특정 메타데이터를 로드하거나, 트랜잭션을 준비하는 작업이 추가로 필요할 수도 있어.
        
        ### 4. **쿼리 최적화 및 초기 설정**
        
        - 일부 DB는 연결이 생성될 때 **초기 쿼리**를 실행해서 기본 환경을 설정해.
        - 예를 들어, `SET autocommit=0;`, `SET timezone='UTC';` 같은 설정들이 포함될 수 있음.
        - 이런 초기 작업들도 연결을 생성할 때마다 반복적으로 수행되면 부하가 발생해.
        
        ### 5. **멀티스레드 환경에서 동시성 비용**
        
        - 웹 애플리케이션처럼 동시 접속이 많은 환경에서는 **동시에 많은 connection이 생성**될 수 있어.
        - DBMS는 여러 개의 connection을 처리하기 위해 **락(Lock) 관리**, **컨텍스트 스위칭(Context Switching)** 등의 작업을 수행해야 해서 부하가 커질 수 있어.
        
        ---
        
        ### ✅ **그래서 Connection Pool이 필요한 이유**
        
        Connection Pool을 사용하면 **미리 일정 개수의 Connection을 만들어두고** 필요할 때 재사용하므로,
        
        - **새로운 연결을 만드는 비용을 줄이고**
        - **DB 서버의 부하를 줄이며**
        - **애플리케이션 응답 속도를 빠르게 할 수 있어**
        
        이런 이유로 HikariCP, C3P0, DBCP 같은 Connection Pool을 사용하는 거야. 🚀
        

---

# 2. 환경설정

- Maven으로 진행
- resource파일에 `SqlMapConfig.xml` 로 진행
    - 문서 상단에 dtd 명시
    
    ```java
    <?xml version="1.0" encoding="UTF-8"?>
    <!DOCTYPE configuration
            PUBLIC "-//mybatis.org/DTD Config 3.0//EN"
            "http://mybatis.org/dtd/mybatis-3-config.dtd" >
    
    ```
