# Servlet

- Client Side
    - Web client(Web browser) ⇒ chrome 등
- Server Side
    - Web server + WAS = Tomcat

## 통신 과정(동적 앱)

1. 클라이언트가 웹 브라우져에서 **웹 서버**에게 서비스를 요청합니다. **이때 HTTP 프로토콜**을 기반으로 요청정보가 만들어져 웹서버에 전달됩니다.
2. 웹서버는 클라이언트로부터 전달받은 요청정보의 `URI`를 살펴보고 servlet 요청이면 WAS에게 처리를 넘깁니다.
3. WAS안의 `Servlet Container`는 요청받은 `servlet class의 instance`를 찾습니다.
4. 이때 만약 이 클라이언트의 request가 최초의 request이면, 다시말하면 servlet instance가 없다면 servlet class로부터 instance를 생성하고 `init()`를 호출합니다. 만약 servlet instance가 이미 존재하고 있다면 servlet instance를 다시 생성하지 않습니다.
    1. 보통 생성자가 이 일을 하는데, 생성자가 대신 init 이용해서 초기화 진행
5. init()이 끝난후에 `Servlet Container`는 client의 요청에 대한 내용을 `HttpServletReqeust class type`의 객체로 생성합니다. 당연히 이 객체안에는 클라이언트가 보낸 요청정보가 들어있습니다. 또한 응답을 위해 `HttpServletResponse class type`의 객체도 하나 생성합니다.
6. `WAS`안에있는 `Thread Invoker`에 의해 클라이언트의 요청을 처리할 `Thread`가 하나 생성되고 이 Thread가 생성된 Servlet instance가 가지고 있는 `service()` 메소드를 호출합니다. 이때 Container에 의해 생성된 객체 2개가 이 `service()`함수의 인자로 전달됩니다.
7. `service()` 함수는 기본적으로 client의 요청이 어떤 request method를 이용했는지를 파악해 그에 맞는 `doXXX() method`를 호출합니다.
    1. `service()`는 이미 하는 일이 구현되어 있어 overriding하지 않음
8. 최종 처리는 해당 `doXXX()` method에서 `request`와 `response`객체를 이용하여 처리하게 됩니다.
    1. `doXXX()` 메소드를 overriding해서 클라이언트가 원하는 작업 수행하면 된다
9. `destroy()` : servlet instance가 WAS에서 삭제될 때 수행되는 method ⇒ 사용하고 있는 여러 resource를 해제해야 한다.

---

## 폴더 구조

- html같은 static 파일들은 webapp 폴더에 저장
- `web.xml` : Servlet에 논리적인 이름을 부여해서, 클라이언트가 그것 활용해 Servlet을 호출할 수 있도록 설정
    - 관리면에서는 좋음, but 번거로움
    - 따라서 **annotation**을 이용해서 논리적인 이름 설정(url mapping) ⇒ 일반적인 방법

## Response

```java
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        System.out.println("doGet");

        // 입력받기

        // 로직처리하기

        // 출력하기
        // 1, 데이터 전달 통로를 열어서 결과데이터를 전달해야 하는데
        // 이 통로를 통해서 전달되는 데이터의 형태가 어떤 형태인지를 먼저 지정해야 함
        resp.setContentType("text/html; charset=utf-8"); // MIME type

        // 2. 결과를 돌려주기 위한 데이터 통로를 하나 열어야 함.
        // 데이터 통로는 일반적으로 PrintWriter 이용
        PrintWriter out = resp.getWriter();

        // 3. 이 통로를 통해서 데이터를 전송하면 된다.
        out.println("<html>");
        out.println("<head></head>");
        out.println("<body> 정상적으로 호출되었어요</body>");
        out.println("</html>");
        out.flush(); // 명시적으로 하는 게 좋음 => 클라이언트에 넘겨주기 쉬움
        out.close();

    }
```
