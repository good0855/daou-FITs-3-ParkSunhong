```
package booksearchdi.view;

import javafx.application.Application;
import javafx.fxml.FXMLLoader;
import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.stage.Stage;


public class BookSearchView extends Application {
    /*
        FXML LOAD작업
     */
    @Override
    public void start(Stage stage) {
        try {
            FXMLLoader loader = new FXMLLoader(getClass().getResource("tableviewexample.fxml"));
            Parent root = loader.load();

            Scene scene = new Scene(root);
            stage.setScene(scene);
            stage.setTitle("Book Search MVC2");
            stage.show(); // 창 띄우기

        } catch (Exception e) {
            System.out.println("FXML 파일 로드 중 오류 발생");
            e.printStackTrace();
        }
    }

    /*
        호출
     */
    public static void main(String[] args) {
        launch(args);
    }
}

```
package booksearchdi.util;

import java.sql.Connection;
import java.sql.SQLException;

public interface ConnectionManager {
    Connection getConnection() throws SQLException, ClassNotFoundException;
}

```
package booksearchdi.util;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class ConnectionManagerOracle implements ConnectionManager {

    // Static method for connection
    public Connection getConnection() throws SQLException, ClassNotFoundException {
        Connection con = null;

        Class.forName("oracle.jdbc.driver.OracleDriver"); // Oracle JDBC 드라이버 로드

        String JDBC_URL = "jdbc:oracle:thin:@localhost:1521:xe"; // DB 연결 정보
        String ID = "C##DEV";
        String PW = "1234";

        con = DriverManager.getConnection(JDBC_URL, ID, PW);
        System.out.println("Connection established");

        return con;
    }
}

```

```
package booksearchdi.service;

import booksearchdi.vo.BookVO;
import javafx.collections.ObservableList;

import java.sql.SQLException;

public interface BookSearchService {
    public ObservableList<BookVO> searchBooks(String keyword) throws SQLException, ClassNotFoundException;
}


```

```
package booksearchdi.service;

import booksearchdi.dao.BookDAO;
import booksearchdi.util.ConnectionManager;
import booksearchdi.util.ConnectionManagerOracle;
import booksearchdi.vo.BookVO;
import javafx.collections.ObservableList;

import java.sql.Connection;
import java.sql.SQLException;

public class BookSearchServiceImpl implements BookSearchService {

    private static BookSearchServiceImpl instance;

    private BookDAO bookDAO;
    private Connection con;

    // 생성자
    private BookSearchServiceImpl() {
        try {
            // Initialize connection and BookDAO
            ConnectionManager cm = new ConnectionManagerOracle();
            this.con = cm.getConnection();
            this.bookDAO = BookDAO.getInstance(con);
        } catch (SQLException | ClassNotFoundException e) {
            e.printStackTrace();
        }
    }

    public static BookSearchServiceImpl getInstance() {
        if (instance == null) {
            instance = new BookSearchServiceImpl();
        }
        return instance;
    }

    /*
        책 검색
     */
    @Override
    public ObservableList<BookVO> searchBooks(String keyword) throws SQLException {
        // 트랜잭션 설정
        con.setAutoCommit(false);

        ObservableList<BookVO> books = bookDAO.search(keyword);

        // 트랜잭션 커밋 또는 롤백
        if (books == null || books.isEmpty()) {
            con.rollback();
        } else {
            con.commit();
        }

        // 반환 전에 연결 닫지 않음 (BookDAO에서 관리)
        return books;
    }

    // 메서드에서 연결을 닫을 필요는 없으므로, 필요시 종료시점에 연결을 닫을 수 있습니다.
    public void closeConnection() throws SQLException {
        if (con != null && !con.isClosed()) {
            con.close();
        }
    }
}

```

```
package booksearchdi.controller;

import booksearchdi.service.BookSearchServiceImpl;
import booksearchdi.vo.BookVO;
import javafx.collections.ObservableList;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;

import javafx.scene.control.*;
import javafx.scene.control.cell.PropertyValueFactory;

import java.net.URL;
import java.util.ResourceBundle;

/**
 * JavaFX 기반의 도서 검색 화면(View) 클래스.
 * FXML을 로드하여 UI를 구성하고, 도서 목록을 표시하는 기능을 제공한다.
 */
public class BookSearchController implements Initializable {

    /** TableView를 통해 도서 목록을 표시한다. */
    @FXML
    private TableView<BookVO> tableView;

    @FXML
    private Button searchBtn;

    @FXML
    private MenuItem editMenuItem;  // "수정" 메뉴 추가

    @FXML
    private MenuItem deleteMenuItem;

    @FXML
    private TableColumn<BookVO, String> isbnCol;

    @FXML
    private TableColumn<BookVO, String> titleCol;

    @FXML
    private TableColumn<BookVO, Integer> priceCol;

    @FXML
    private TableColumn<BookVO, String> authorCol;

    @FXML
    private TextField inputField;

    // 검색 service
    private final BookSearchServiceImpl bookSearchServiceImpl = BookSearchServiceImpl.getInstance();

    private String deleteIsbn;

    @Override
    public void initialize(URL url, ResourceBundle resourceBundle) {
        // FXML이 LOAD될 때 메소드 호출!
        // button이 클릭되면 TableView에 데이터 넣어야 함

        // vo에 bisbn필드를 이용해서 값 채울 거임
        isbnCol.setCellValueFactory(new PropertyValueFactory<>("bisbn"));
        titleCol.setCellValueFactory(new PropertyValueFactory<>("btitle"));
        priceCol.setCellValueFactory(new PropertyValueFactory<>("bprice"));
        authorCol.setCellValueFactory(new PropertyValueFactory<>("bauthor"));

//        tableView.setRowFactory(e -> {
//            TableRow<BookVO> row = new TableRow<BookVO>();
//            row.setOnMouseClicked(event -> {
//                if(event.getClickCount() == 1) {
//                    BookVO book = row.getItem();
//                    deleteIsbn = book.getBisbn();
//                }
//            });
//
//            return row;
//        });


        // 검색 버튼을 클릭할 시 검색 결과가 나오도록 수정
        searchBtn.setOnAction(event -> {
            searchBooks();

        });
    }
    /**
     * TableView에 도서 목록을 설정하여 화면에 표시한다.
     *
     */
    private void searchBooks() {
        String keyword = inputField.getText().strip();
        // TODO: 향후 리팩토링
        try {
            ObservableList<BookVO> books = bookSearchServiceImpl.searchBooks(keyword);
            tableView.setItems(books);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}

```


```
package booksearchdi.dao;

import booksearchdi.vo.BookVO;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class BookDAO {

    private Connection con;

    private static BookDAO instance;

    private BookDAO(Connection con) {
        this.con = con;
    }
    public static BookDAO getInstance(Connection con) {
        if (instance == null) {
            instance = new BookDAO(con);
        }
        return instance;
    }

    /*
        BOOK 검색
     */
    public ObservableList<BookVO> search(String keyword) {
        ObservableList<BookVO> books = FXCollections.observableArrayList();

        try {
            // 검색
            String sql = "SELECT bisbn, btitle, bprice, bauthor" +
                    " FROM book" +
                    " WHERE btitle LIKE ?";

            PreparedStatement pstmt = con.prepareStatement(sql);
            pstmt.setString(1, "%" + keyword + "%");

            // 결과 반환
            ResultSet rs = pstmt.executeQuery();

            while (rs.next()) {
                BookVO book = new BookVO(
                        rs.getString("bisbn"),
                        rs.getString("btitle"),
                        rs.getInt("bprice"),
                        rs.getString("bauthor")
                );

                books.add(book);
            }

            rs.close();
            pstmt.close();
            System.out.println(keyword +  "검색 완료");


        } catch (SQLException e) {
            e.printStackTrace();
        }

        return books;



    }

}

```

```
package booksearchdi.vo;

public class BookVO {
    private String bisbn;
    private String btitle;
    private int bprice;
    private String bauthor;

    public BookVO() {

    }

    public BookVO(String bisbn, String btitle, int bprice, String bauthor) {
        this.bisbn = bisbn;
        this.btitle = btitle;
        this.bprice = bprice;
        this.bauthor = bauthor;
    }

    public String getBisbn() {
        return bisbn;
    }

    public void setBisbn(String bisbn) {
        this.bisbn = bisbn;
    }

    public String getBtitle() {
        return btitle;
    }

    public void setBtitle(String btitle) {
        this.btitle = btitle;
    }

    public int getBprice() {
        return bprice;
    }

    public void setBprice(int bprice) {
        this.bprice = bprice;
    }

    public String getBauthor() {
        return bauthor;
    }

    public void setBauthor(String bauthor) {
        this.bauthor = bauthor;
    }

    @Override
    public String toString() {
        return "Book{" +
                "bisbn='" + bisbn + '\'' +
                ", btitle='" + btitle + '\'' +
                ", bprice=" + bprice +
                ", bauthor='" + bauthor + '\'' +
                '}';
    }
}

```
